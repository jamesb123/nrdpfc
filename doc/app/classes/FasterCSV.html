<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html 
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>Class: FasterCSV</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="Content-Script-Type" content="text/javascript" />
  <link rel="stylesheet" href=".././rdoc-style.css" type="text/css" media="screen" />
  <script type="text/javascript">
  // <![CDATA[

  function popupCode( url ) {
    window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
  }

  function toggleCode( id ) {
    if ( document.getElementById )
      elem = document.getElementById( id );
    else if ( document.all )
      elem = eval( "document.all." + id );
    else
      return false;

    elemStyle = elem.style;
    
    if ( elemStyle.display != "block" ) {
      elemStyle.display = "block"
    } else {
      elemStyle.display = "none"
    }

    return true;
  }
  
  // Make codeblocks hidden by default
  document.writeln( "<style type=\"text/css\">div.method-source-code { display: none }</style>" )
  
  // ]]>
  </script>

</head>
<body>



    <div id="classHeader">
        <table class="header-table">
        <tr class="top-aligned-row">
          <td><strong>Class</strong></td>
          <td class="class-name-in-header">FasterCSV</td>
        </tr>
        <tr class="top-aligned-row">
            <td><strong>In:</strong></td>
            <td>
                <a href="../files/lib/faster_csv_rb.html">
                lib/faster_csv.rb
                </a>
        <br />
            </td>
        </tr>

        <tr class="top-aligned-row">
            <td><strong>Parent:</strong></td>
            <td>
                Object
            </td>
        </tr>
        </table>
    </div>
  <!-- banner header -->

  <div id="bodyContent">



  <div id="contextContent">

    <div id="description">
      <p>
This class provides a complete interface to CSV files and data. It offers
tools to enable you to <a href="FasterCSV.html#M000026">read</a> and write
to and from Strings or IO objects, as needed.
</p>
<h2>Reading</h2>
<h3>From a File</h3>
<h4>A Line at a Time</h4>
<pre>
  FasterCSV.foreach(&quot;path/to/file.csv&quot;) do |row|
    # use row here...
  end
</pre>
<h4>All at Once</h4>
<pre>
  arr_of_arrs = FasterCSV.read(&quot;path/to/file.csv&quot;)
</pre>
<h3>From a <a href="String.html">String</a></h3>
<h4>A Line at a Time</h4>
<pre>
  FasterCSV.parse(&quot;CSV,data,String&quot;) do |row|
    # use row here...
  end
</pre>
<h4>All at Once</h4>
<pre>
  arr_of_arrs = FasterCSV.parse(&quot;CSV,data,String&quot;)
</pre>
<h2>Writing</h2>
<h3>To a File</h3>
<pre>
  FasterCSV.open(&quot;path/to/file.csv&quot;, &quot;w&quot;) do |csv|
    csv &lt;&lt; [&quot;row&quot;, &quot;of&quot;, &quot;CSV&quot;, &quot;data&quot;]
    csv &lt;&lt; [&quot;another&quot;, &quot;row&quot;]
    # ...
  end
</pre>
<h3>To a <a href="String.html">String</a></h3>
<pre>
  csv_string = FasterCSV.generate do |csv|
    csv &lt;&lt; [&quot;row&quot;, &quot;of&quot;, &quot;CSV&quot;, &quot;data&quot;]
    csv &lt;&lt; [&quot;another&quot;, &quot;row&quot;]
    # ...
  end
</pre>
<h2>Convert a Single Line</h2>
<pre>
  csv_string = [&quot;CSV&quot;, &quot;data&quot;].to_csv   # to CSV
  csv_array  = &quot;CSV,String&quot;.parse_csv   # from CSV
</pre>
<h2>Shortcut Interface</h2>
<pre>
  FCSV             { |csv_out| csv_out &lt;&lt; %w{my data here} }  # to $stdout
  FCSV(csv = &quot;&quot;)   { |csv_str| csv_str &lt;&lt; %w{my data here} }  # to a String
  FCSV($stderr)    { |csv_err| csv_err &lt;&lt; %w{my data here} }  # to $stderr
</pre>

    </div>


   </div>

    <div id="method-list">
      <h3 class="section-bar">Methods</h3>

      <div class="name-list">
      <a href="#M000031">&lt;&lt;</a>&nbsp;&nbsp;
      <a href="#M000032">add_row</a>&nbsp;&nbsp;
      <a href="#M000015">build_csv_interface</a>&nbsp;&nbsp;
      <a href="#M000034">convert</a>&nbsp;&nbsp;
      <a href="#M000016">dump</a>&nbsp;&nbsp;
      <a href="#M000036">each</a>&nbsp;&nbsp;
      <a href="#M000017">filter</a>&nbsp;&nbsp;
      <a href="#M000018">foreach</a>&nbsp;&nbsp;
      <a href="#M000019">generate</a>&nbsp;&nbsp;
      <a href="#M000020">generate_line</a>&nbsp;&nbsp;
      <a href="#M000041">gets</a>&nbsp;&nbsp;
      <a href="#M000035">header_convert</a>&nbsp;&nbsp;
      <a href="#M000039">header_row?</a>&nbsp;&nbsp;
      <a href="#M000021">instance</a>&nbsp;&nbsp;
      <a href="#M000022">load</a>&nbsp;&nbsp;
      <a href="#M000029">new</a>&nbsp;&nbsp;
      <a href="#M000023">open</a>&nbsp;&nbsp;
      <a href="#M000024">parse</a>&nbsp;&nbsp;
      <a href="#M000025">parse_line</a>&nbsp;&nbsp;
      <a href="#M000033">puts</a>&nbsp;&nbsp;
      <a href="#M000026">read</a>&nbsp;&nbsp;
      <a href="#M000037">read</a>&nbsp;&nbsp;
      <a href="#M000042">readline</a>&nbsp;&nbsp;
      <a href="#M000038">readlines</a>&nbsp;&nbsp;
      <a href="#M000027">readlines</a>&nbsp;&nbsp;
      <a href="#M000030">rewind</a>&nbsp;&nbsp;
      <a href="#M000040">shift</a>&nbsp;&nbsp;
      <a href="#M000028">table</a>&nbsp;&nbsp;
      </div>
    </div>

  </div>


    <!-- if includes -->
    <div id="includes">
      <h3 class="section-bar">Included Modules</h3>

      <div id="includes-list">
        <span class="include-name">Enumerable</span>
      </div>
    </div>

    <div id="section">

    <div id="class-list">
      <h3 class="section-bar">Classes and Modules</h3>

      Class <a href="FasterCSV/MalformedCSVError.html" class="link">FasterCSV::MalformedCSVError</a><br />
Class <a href="FasterCSV/Row.html" class="link">FasterCSV::Row</a><br />
Class <a href="FasterCSV/Table.html" class="link">FasterCSV::Table</a><br />

    </div>

    <div id="constants-list">
      <h3 class="section-bar">Constants</h3>

      <div class="name-list">
        <table summary="Constants">
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">VERSION</td>
          <td>=</td>
          <td class="context-item-value">&quot;1.2.0&quot;.freeze</td>
          <td width="3em">&nbsp;</td>
          <td class="context-item-desc">
The version of the installed library.

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">FieldInfo</td>
          <td>=</td>
          <td class="context-item-value">Struct.new(:index, :line, :header)</td>
          <td width="3em">&nbsp;</td>
          <td class="context-item-desc">
A FieldInfo Struct contains details about a field&#8216;s position in the
data source it was <a href="FasterCSV.html#M000026">read</a> from. <a
href="FasterCSV.html">FasterCSV</a> will pass this Struct to some blocks
that make decisions based on field structure. See
FasterCSV.convert_fields() for an example.

<table>
<tr><td valign="top"><b><tt>index</tt></b>:</td><td>The zero-based index of the field in its row.

</td></tr>
<tr><td valign="top"><b><tt>line</tt></b>:</td><td>The line of the data source this row is from.

</td></tr>
<tr><td valign="top"><b><tt>header</tt></b>:</td><td>The header for the column, when available.

</td></tr>
</table>
</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">Converters</td>
          <td>=</td>
          <td class="context-item-value">{ :integer   =&gt; lambda { |f| Integer(f)        rescue f },                  :float     =&gt; lambda { |f| Float(f)          rescue f },                  :numeric   =&gt; [:integer, :float],                  :date      =&gt; lambda { |f| Date.parse(f)     rescue f },                  :date_time =&gt; lambda { |f| DateTime.parse(f) rescue f },                  :all       =&gt; [:date_time, :numeric] }</td>
          <td width="3em">&nbsp;</td>
          <td class="context-item-desc">
This <a href="Hash.html">Hash</a> holds the built-in converters of <a
href="FasterCSV.html">FasterCSV</a> that can be accessed by name. You can
select Converters with <a
href="FasterCSV.html#M000034">FasterCSV.convert</a>() or through the
<tt>options</tt> <a href="Hash.html">Hash</a> passed to FasterCSV::new().

<table>
<tr><td valign="top"><b><tt>:integer</tt></b>:</td><td>Converts any field Integer() accepts.

</td></tr>
<tr><td valign="top"><b><tt>:float</tt></b>:</td><td>Converts any field Float() accepts.

</td></tr>
<tr><td valign="top"><b><tt>:numeric</tt></b>:</td><td>A combination of <tt>:integer</tt> and <tt>:float</tt>.

</td></tr>
<tr><td valign="top"><b><tt>:date</tt></b>:</td><td>Converts any field Date::parse() accepts.

</td></tr>
<tr><td valign="top"><b><tt>:date_time</tt></b>:</td><td>Converts any field DateTime::parse() accepts.

</td></tr>
<tr><td valign="top"><b><tt>:all</tt></b>:</td><td>All built-in converters. A combination of <tt>:date_time</tt> and
<tt>:numeric</tt>.

</td></tr>
</table>
<p>
This <a href="Hash.html">Hash</a> is intetionally left unfrozen and users
should feel free to add values to it that can be accessed by all <a
href="FasterCSV.html">FasterCSV</a> objects.
</p>
<p>
To add a combo field, the value should be an <a href="Array.html">Array</a>
of names. Combo fields can be nested with other combo fields.
</p>
</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">HeaderConverters</td>
          <td>=</td>
          <td class="context-item-value">{     :downcase =&gt; lambda { |h| h.downcase },     :symbol   =&gt; lambda { |h|       h.downcase.tr(&quot; &quot;, &quot;_&quot;).delete(&quot;^a-z0-9_&quot;).to_sym</td>
          <td width="3em">&nbsp;</td>
          <td class="context-item-desc">
This <a href="Hash.html">Hash</a> holds the built-in header converters of
<a href="FasterCSV.html">FasterCSV</a> that can be accessed by name. You
can select HeaderConverters with <a
href="FasterCSV.html#M000035">FasterCSV.header_convert</a>() or through the
<tt>options</tt> <a href="Hash.html">Hash</a> passed to FasterCSV::new().

<table>
<tr><td valign="top"><b><tt>:downcase</tt></b>:</td><td>Calls downcase() on the header <a href="String.html">String</a>.

</td></tr>
<tr><td valign="top"><b><tt>:symbol</tt></b>:</td><td>The header <a href="String.html">String</a> is downcased, spaces are
replaced with underscores, non-word characters are dropped, and finally
to_sym() is called.

</td></tr>
</table>
<p>
This <a href="Hash.html">Hash</a> is intetionally left unfrozen and users
should feel free to add values to it that can be accessed by all <a
href="FasterCSV.html">FasterCSV</a> objects.
</p>
<p>
To add a combo field, the value should be an <a href="Array.html">Array</a>
of names. Combo fields can be nested with other combo fields.
</p>
</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">DEFAULT_OPTIONS</td>
          <td>=</td>
          <td class="context-item-value">{ :col_sep            =&gt; &quot;,&quot;,                       :row_sep            =&gt; :auto,                       :converters         =&gt; nil,                       :unconverted_fields =&gt; nil,                       :headers            =&gt; false,                       :return_headers     =&gt; false,                       :header_converters  =&gt; nil,                       :skip_blanks        =&gt; false,                       :force_quotes       =&gt; false }.freeze</td>
          <td width="3em">&nbsp;</td>
          <td class="context-item-desc">
The options used when no overrides are given by calling code. They are:

<table>
<tr><td valign="top"><b><tt>:col_sep</tt></b>:</td><td><tt>&quot;,&quot;</tt>

</td></tr>
<tr><td valign="top"><b><tt>:row_sep</tt></b>:</td><td><tt>:auto</tt>

</td></tr>
<tr><td valign="top"><b><tt>:converters</tt></b>:</td><td><tt>nil</tt>

</td></tr>
<tr><td valign="top"><b><tt>:unconverted_fields</tt></b>:</td><td><tt>nil</tt>

</td></tr>
<tr><td valign="top"><b><tt>:headers</tt></b>:</td><td><tt>false</tt>

</td></tr>
<tr><td valign="top"><b><tt>:return_headers</tt></b>:</td><td><tt>false</tt>

</td></tr>
<tr><td valign="top"><b><tt>:header_converters</tt></b>:</td><td><tt>nil</tt>

</td></tr>
<tr><td valign="top"><b><tt>:skip_blanks</tt></b>:</td><td><tt>false</tt>

</td></tr>
<tr><td valign="top"><b><tt>:force_quotes</tt></b>:</td><td><tt>false</tt>

</td></tr>
</table>
</td>
        </tr>
        </table>
      </div>
    </div>



    <div id="attribute-list">
      <h3 class="section-bar">Attributes</h3>

      <div class="name-list">
        <table>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">lineno</td>
          <td class="context-item-value">&nbsp;[R]&nbsp;</td>
          <td class="context-item-desc">
The line number of the last row <a href="FasterCSV.html#M000026">read</a>
from this file. Fields with nested line-end characters will not affect this
count.

</td>
        </tr>
        </table>
      </div>
    </div>
      


    <!-- if method_list -->
    <div id="methods">
      <h3 class="section-bar">Public Class methods</h3>

      <div id="method-M000015" class="method-detail">
        <a name="M000015"></a>

        <div class="method-heading">
          <a href="#M000015" class="method-signature">
          <span class="method-name">build_csv_interface</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
This method will build a drop-in replacement for many of the standard CSV
methods. It allows you to write code like:
</p>
<pre>
  begin
    require &quot;faster_csv&quot;
    FasterCSV.build_csv_interface
  rescue LoadError
    require &quot;csv&quot;
  end
  # ... use CSV here ...
</pre>
<p>
This is not a complete interface with completely identical behavior.
However, it is intended to be close enough that you won&#8216;t notice the
difference in most cases. CSV methods supported are:
</p>
<ul>
<li><a href="FasterCSV.html#M000018">foreach</a>()

</li>
<li><a href="FasterCSV.html#M000020">generate_line</a>()

</li>
<li><a href="FasterCSV.html#M000023">open</a>()

</li>
<li><a href="FasterCSV.html#M000024">parse</a>()

</li>
<li><a href="FasterCSV.html#M000025">parse_line</a>()

</li>
<li><a href="FasterCSV.html#M000027">readlines</a>()

</li>
</ul>
<p>
Be warned that this interface is slower than vanilla <a
href="FasterCSV.html">FasterCSV</a> due to the extra layer of method calls.
Depending on usage, this can slow it down to near CSV speeds.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000015-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000015-source">
<pre>
     <span class="ruby-comment cmt"># File lib/faster_csv.rb, line 816</span>
816:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">build_csv_interface</span>
817:     <span class="ruby-constant">Object</span>.<span class="ruby-identifier">const_set</span>(<span class="ruby-identifier">:CSV</span>, <span class="ruby-constant">Class</span>.<span class="ruby-identifier">new</span>).<span class="ruby-identifier">class_eval</span> <span class="ruby-keyword kw">do</span>
818:       <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">foreach</span>(<span class="ruby-identifier">path</span>, <span class="ruby-identifier">rs</span> = <span class="ruby-identifier">:auto</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)  <span class="ruby-comment cmt"># :nodoc:</span>
819:         <span class="ruby-constant">FasterCSV</span>.<span class="ruby-identifier">foreach</span>(<span class="ruby-identifier">path</span>, <span class="ruby-identifier">:row_sep</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">rs</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
820:       <span class="ruby-keyword kw">end</span>
821:       
822:       <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">generate_line</span>(<span class="ruby-identifier">row</span>, <span class="ruby-identifier">fs</span> = <span class="ruby-value str">&quot;,&quot;</span>, <span class="ruby-identifier">rs</span> = <span class="ruby-value str">&quot;&quot;</span>)  <span class="ruby-comment cmt"># :nodoc:</span>
823:         <span class="ruby-constant">FasterCSV</span>.<span class="ruby-identifier">generate_line</span>(<span class="ruby-identifier">row</span>, <span class="ruby-identifier">:col_sep</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">fs</span>, <span class="ruby-identifier">:row_sep</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">rs</span>)
824:       <span class="ruby-keyword kw">end</span>
825:       
826:       <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">open</span>(<span class="ruby-identifier">path</span>, <span class="ruby-identifier">mode</span>, <span class="ruby-identifier">fs</span> = <span class="ruby-value str">&quot;,&quot;</span>, <span class="ruby-identifier">rs</span> = <span class="ruby-identifier">:auto</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)  <span class="ruby-comment cmt"># :nodoc:</span>
827:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">block</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">mode</span>.<span class="ruby-identifier">include?</span> <span class="ruby-value str">&quot;r&quot;</span>
828:           <span class="ruby-constant">FasterCSV</span>.<span class="ruby-identifier">open</span>(<span class="ruby-identifier">path</span>, <span class="ruby-identifier">mode</span>, <span class="ruby-identifier">:col_sep</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">fs</span>, <span class="ruby-identifier">:row_sep</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">rs</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">csv</span><span class="ruby-operator">|</span>
829:             <span class="ruby-identifier">csv</span>.<span class="ruby-identifier">each</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
830:           <span class="ruby-keyword kw">end</span>
831:         <span class="ruby-keyword kw">else</span>
832:           <span class="ruby-constant">FasterCSV</span>.<span class="ruby-identifier">open</span>(<span class="ruby-identifier">path</span>, <span class="ruby-identifier">mode</span>, <span class="ruby-identifier">:col_sep</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">fs</span>, <span class="ruby-identifier">:row_sep</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">rs</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
833:         <span class="ruby-keyword kw">end</span>
834:       <span class="ruby-keyword kw">end</span>
835:       
836:       <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-identifier">str_or_readable</span>, <span class="ruby-identifier">fs</span> = <span class="ruby-value str">&quot;,&quot;</span>, <span class="ruby-identifier">rs</span> = <span class="ruby-identifier">:auto</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)  <span class="ruby-comment cmt"># :nodoc:</span>
837:         <span class="ruby-constant">FasterCSV</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-identifier">str_or_readable</span>, <span class="ruby-identifier">:col_sep</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">fs</span>, <span class="ruby-identifier">:row_sep</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">rs</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
838:       <span class="ruby-keyword kw">end</span>
839:       
840:       <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">parse_line</span>(<span class="ruby-identifier">src</span>, <span class="ruby-identifier">fs</span> = <span class="ruby-value str">&quot;,&quot;</span>, <span class="ruby-identifier">rs</span> = <span class="ruby-identifier">:auto</span>)  <span class="ruby-comment cmt"># :nodoc:</span>
841:         <span class="ruby-constant">FasterCSV</span>.<span class="ruby-identifier">parse_line</span>(<span class="ruby-identifier">src</span>, <span class="ruby-identifier">:col_sep</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">fs</span>, <span class="ruby-identifier">:row_sep</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">rs</span>)
842:       <span class="ruby-keyword kw">end</span>
843:       
844:       <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">readlines</span>(<span class="ruby-identifier">path</span>, <span class="ruby-identifier">rs</span> = <span class="ruby-identifier">:auto</span>)  <span class="ruby-comment cmt"># :nodoc:</span>
845:         <span class="ruby-constant">FasterCSV</span>.<span class="ruby-identifier">readlines</span>(<span class="ruby-identifier">path</span>, <span class="ruby-identifier">:row_sep</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">rs</span>)
846:       <span class="ruby-keyword kw">end</span>
847:     <span class="ruby-keyword kw">end</span>
848:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000016" class="method-detail">
        <a name="M000016"></a>

        <div class="method-heading">
          <a href="#M000016" class="method-signature">
          <span class="method-name">dump</span><span class="method-args">(ary_of_objs, io = &quot;&quot;, options = Hash.new)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
This method allows you to serialize an <a href="Array.html">Array</a> of
Ruby objects to a <a href="String.html">String</a> or File of CSV data.
This is not as powerful as Marshal or YAML, but perhaps useful for
spreadsheet and database interaction.
</p>
<p>
Out of the box, this method is intended to work with simple data objects or
Structs. It will serialize a list of <a
href="FasterCSV.html#M000021">instance</a> variables and/or
Struct.members().
</p>
<p>
If you need need more complicated serialization, you can control the
process by adding methods to the class to be serialized.
</p>
<p>
A class method csv_meta() is responsible for returning the first row of the
document (as an <a href="Array.html">Array</a>). This row is considered to
be a <a href="Hash.html">Hash</a> of the form
key_1,value_1,key_2,value_2,&#8230; FasterCSV::load() expects to find a
class key with a value of the stringified class name and FasterCSV::dump()
will create this, if you do not define this method. This method is only
called on the first object of the <a href="Array.html">Array</a>.
</p>
<p>
The next method you can provide is an <a
href="FasterCSV.html#M000021">instance</a> method called csv_headers().
This method is expected to return the second line of the document (again as
an <a href="Array.html">Array</a>), which is to be used to give <a
href="FasterCSV.html#M000036">each</a> column a header. By default,
FasterCSV::load() will set an <a href="FasterCSV.html#M000021">instance</a>
variable if the field header starts with an @ character or call send()
passing the header as the method name and the field value as an argument.
This method is only called on the first object of the <a
href="Array.html">Array</a>.
</p>
<p>
Finally, you can provide an <a href="FasterCSV.html#M000021">instance</a>
method called csv_dump(), which will be passed the headers. This should
return an <a href="Array.html">Array</a> of fields that can be serialized
for this object. This method is called once for every object in the <a
href="Array.html">Array</a>.
</p>
<p>
The <tt>io</tt> parameter can be used to serialize to a File, and
<tt>options</tt> can be anything FasterCSV::new() accepts.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000016-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000016-source">
<pre>
     <span class="ruby-comment cmt"># File lib/faster_csv.rb, line 885</span>
885:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">dump</span>(<span class="ruby-identifier">ary_of_objs</span>, <span class="ruby-identifier">io</span> = <span class="ruby-value str">&quot;&quot;</span>, <span class="ruby-identifier">options</span> = <span class="ruby-constant">Hash</span>.<span class="ruby-identifier">new</span>)
886:     <span class="ruby-identifier">obj_template</span> = <span class="ruby-identifier">ary_of_objs</span>.<span class="ruby-identifier">first</span>
887:     
888:     <span class="ruby-identifier">csv</span> = <span class="ruby-constant">FasterCSV</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">io</span>, <span class="ruby-identifier">options</span>)
889:     
890:     <span class="ruby-comment cmt"># write meta information</span>
891:     <span class="ruby-keyword kw">begin</span>
892:       <span class="ruby-identifier">csv</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">obj_template</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">csv_meta</span>
893:     <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">NoMethodError</span>
894:       <span class="ruby-identifier">csv</span> <span class="ruby-operator">&lt;&lt;</span> [<span class="ruby-identifier">:class</span>, <span class="ruby-identifier">obj_template</span>.<span class="ruby-identifier">class</span>]
895:     <span class="ruby-keyword kw">end</span>
896: 
897:     <span class="ruby-comment cmt"># write headers</span>
898:     <span class="ruby-keyword kw">begin</span>
899:       <span class="ruby-identifier">headers</span> = <span class="ruby-identifier">obj_template</span>.<span class="ruby-identifier">csv_headers</span>
900:     <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">NoMethodError</span>
901:       <span class="ruby-identifier">headers</span> = <span class="ruby-identifier">obj_template</span>.<span class="ruby-identifier">instance_variables</span>.<span class="ruby-identifier">sort</span>
902:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">obj_template</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">ancestors</span>.<span class="ruby-identifier">find</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">cls</span><span class="ruby-operator">|</span> <span class="ruby-identifier">cls</span>.<span class="ruby-identifier">to_s</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp re">/\AStruct\b/</span> }
903:         <span class="ruby-identifier">headers</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">obj_template</span>.<span class="ruby-identifier">members</span>.<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">mem</span><span class="ruby-operator">|</span> <span class="ruby-node">&quot;#{mem}=&quot;</span> }.<span class="ruby-identifier">sort</span>
904:       <span class="ruby-keyword kw">end</span>
905:     <span class="ruby-keyword kw">end</span>
906:     <span class="ruby-identifier">csv</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">headers</span>
907:     
908:     <span class="ruby-comment cmt"># serialize each object</span>
909:     <span class="ruby-identifier">ary_of_objs</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">obj</span><span class="ruby-operator">|</span>
910:       <span class="ruby-keyword kw">begin</span>
911:         <span class="ruby-identifier">csv</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">obj</span>.<span class="ruby-identifier">csv_dump</span>(<span class="ruby-identifier">headers</span>)
912:       <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">NoMethodError</span>
913:         <span class="ruby-identifier">csv</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">headers</span>.<span class="ruby-identifier">map</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">var</span><span class="ruby-operator">|</span>
914:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">var</span>[<span class="ruby-value">0</span>] <span class="ruby-operator">==</span> <span class="ruby-value">?@</span>
915:             <span class="ruby-identifier">obj</span>.<span class="ruby-identifier">instance_variable_get</span>(<span class="ruby-identifier">var</span>)
916:           <span class="ruby-keyword kw">else</span>
917:             <span class="ruby-identifier">obj</span>[<span class="ruby-identifier">var</span>[<span class="ruby-value">0</span><span class="ruby-operator">..</span><span class="ruby-value">-2</span>]]
918:           <span class="ruby-keyword kw">end</span>
919:         <span class="ruby-keyword kw">end</span>
920:       <span class="ruby-keyword kw">end</span>
921:     <span class="ruby-keyword kw">end</span>
922:     
923:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">io</span>.<span class="ruby-identifier">is_a?</span> <span class="ruby-constant">String</span>
924:       <span class="ruby-identifier">csv</span>.<span class="ruby-identifier">string</span>
925:     <span class="ruby-keyword kw">else</span>
926:       <span class="ruby-identifier">csv</span>.<span class="ruby-identifier">close</span>
927:     <span class="ruby-keyword kw">end</span>
928:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000017" class="method-detail">
        <a name="M000017"></a>

        <div class="method-heading">
          <a href="#M000017" class="method-signature">
          <span class="method-name">filter( options = Hash.new ) { |row| ... }<br />
filter( input, options = Hash.new ) { |row| ... }<br />
filter( input, output, options = Hash.new ) { |row| ... }<br />
</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
This method is a convenience for building Unix-like filters for CSV data.
Each row is yielded to the provided block which can alter it as needed.
After the block returns, the row is appended to <tt>output</tt> altered or
not.
</p>
<p>
The <tt>input</tt> and <tt>output</tt> arguments can be anything
FasterCSV::new() accepts (generally <a href="String.html">String</a> or IO
objects). If not given, they default to <tt>ARGF</tt> and <tt>$stdout</tt>.
</p>
<p>
The <tt>options</tt> parameter is also filtered down to FasterCSV::new()
after some clever key parsing. Any key beginning with <tt>:in_</tt> or
<tt>:input_</tt> will have that leading identifier stripped and will only
be used in the <tt>options</tt> <a href="Hash.html">Hash</a> for the
<tt>input</tt> object. Keys starting with <tt>:out_</tt> or
<tt>:output_</tt> affect only <tt>output</tt>. All other keys are assigned
to both objects.
</p>
<p>
The <tt>:output_row_sep</tt> <tt>option</tt> defaults to
<tt>$INPUT_RECORD_SEPARATOR</tt> (<tt>$/</tt>).
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000017-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000017-source">
<pre>
     <span class="ruby-comment cmt"># File lib/faster_csv.rb, line 954</span>
954:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">filter</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">args</span>)
955:     <span class="ruby-comment cmt"># parse options for input, output, or both</span>
956:     <span class="ruby-identifier">in_options</span>, <span class="ruby-identifier">out_options</span> = <span class="ruby-constant">Hash</span>.<span class="ruby-identifier">new</span>, {<span class="ruby-identifier">:row_sep</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">$INPUT_RECORD_SEPARATOR</span>}
957:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">args</span>.<span class="ruby-identifier">last</span>.<span class="ruby-identifier">is_a?</span> <span class="ruby-constant">Hash</span>
958:       <span class="ruby-identifier">args</span>.<span class="ruby-identifier">pop</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">key</span>, <span class="ruby-identifier">value</span><span class="ruby-operator">|</span>
959:         <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">key</span>.<span class="ruby-identifier">to_s</span>
960:         <span class="ruby-keyword kw">when</span> <span class="ruby-regexp re">/\Ain(?:put)?_(.+)\Z/</span>
961:           <span class="ruby-identifier">in_options</span>[<span class="ruby-identifier">$1</span>.<span class="ruby-identifier">to_sym</span>] = <span class="ruby-identifier">value</span>
962:         <span class="ruby-keyword kw">when</span> <span class="ruby-regexp re">/\Aout(?:put)?_(.+)\Z/</span>
963:           <span class="ruby-identifier">out_options</span>[<span class="ruby-identifier">$1</span>.<span class="ruby-identifier">to_sym</span>] = <span class="ruby-identifier">value</span>
964:         <span class="ruby-keyword kw">else</span>
965:           <span class="ruby-identifier">in_options</span>[<span class="ruby-identifier">key</span>]  = <span class="ruby-identifier">value</span>
966:           <span class="ruby-identifier">out_options</span>[<span class="ruby-identifier">key</span>] = <span class="ruby-identifier">value</span>
967:         <span class="ruby-keyword kw">end</span>
968:       <span class="ruby-keyword kw">end</span>
969:     <span class="ruby-keyword kw">end</span>
970:     <span class="ruby-comment cmt"># build input and output wrappers</span>
971:     <span class="ruby-identifier">input</span>   = <span class="ruby-constant">FasterCSV</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">args</span>.<span class="ruby-identifier">shift</span> <span class="ruby-operator">||</span> <span class="ruby-constant">ARGF</span>,    <span class="ruby-identifier">in_options</span>)
972:     <span class="ruby-identifier">output</span>  = <span class="ruby-constant">FasterCSV</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">args</span>.<span class="ruby-identifier">shift</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">$stdout</span>, <span class="ruby-identifier">out_options</span>)
973:     
974:     <span class="ruby-comment cmt"># read, yield, write</span>
975:     <span class="ruby-identifier">input</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">row</span><span class="ruby-operator">|</span>
976:       <span class="ruby-keyword kw">yield</span> <span class="ruby-identifier">row</span>
977:       <span class="ruby-identifier">output</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">row</span>
978:     <span class="ruby-keyword kw">end</span>
979:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000018" class="method-detail">
        <a name="M000018"></a>

        <div class="method-heading">
          <a href="#M000018" class="method-signature">
          <span class="method-name">foreach</span><span class="method-args">(path, options = Hash.new, &amp;block)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
This method is intended as the primary interface for reading CSV files. You
pass a <tt>path</tt> and any <tt>options</tt> you wish to set for the <a
href="FasterCSV.html#M000026">read</a>. Each row of file will be passed to
the provided <tt>block</tt> in turn.
</p>
<p>
The <tt>options</tt> parameter can be anything FasterCSV::new()
understands.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000018-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000018-source">
<pre>
     <span class="ruby-comment cmt"># File lib/faster_csv.rb, line 988</span>
988:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">foreach</span>(<span class="ruby-identifier">path</span>, <span class="ruby-identifier">options</span> = <span class="ruby-constant">Hash</span>.<span class="ruby-identifier">new</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
989:     <span class="ruby-identifier">open</span>(<span class="ruby-identifier">path</span>, <span class="ruby-identifier">options</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">csv</span><span class="ruby-operator">|</span>
990:       <span class="ruby-identifier">csv</span>.<span class="ruby-identifier">each</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
991:     <span class="ruby-keyword kw">end</span>
992:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000019" class="method-detail">
        <a name="M000019"></a>

        <div class="method-heading">
          <a href="#M000019" class="method-signature">
          <span class="method-name">generate( str, options = Hash.new ) { |faster_csv| ... }<br />
generate( options = Hash.new ) { |faster_csv| ... }<br />
</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
This method wraps a <a href="String.html">String</a> you provide, or an
empty default <a href="String.html">String</a>, in a <a
href="FasterCSV.html">FasterCSV</a> object which is passed to the provided
block. You can use the block to append CSV rows to the <a
href="String.html">String</a> and when the block exits, the final <a
href="String.html">String</a> will be returned.
</p>
<p>
Note that a passed <a href="String.html">String</a> <b>is</b> modfied by
this method. Call dup() before passing if you need a <a
href="FasterCSV.html#M000029">new</a> <a href="String.html">String</a>.
</p>
<p>
The <tt>options</tt> parameter can be anthing FasterCSV::new() understands.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000019-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000019-source">
<pre>
      <span class="ruby-comment cmt"># File lib/faster_csv.rb, line 1009</span>
1009:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">generate</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">args</span>)
1010:     <span class="ruby-comment cmt"># add a default empty String, if none was given</span>
1011:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">args</span>.<span class="ruby-identifier">first</span>.<span class="ruby-identifier">is_a?</span> <span class="ruby-constant">String</span>
1012:       <span class="ruby-identifier">io</span> = <span class="ruby-constant">StringIO</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">args</span>.<span class="ruby-identifier">shift</span>)
1013:       <span class="ruby-identifier">io</span>.<span class="ruby-identifier">seek</span>(<span class="ruby-value">0</span>, <span class="ruby-constant">IO</span><span class="ruby-operator">::</span><span class="ruby-constant">SEEK_END</span>)
1014:       <span class="ruby-identifier">args</span>.<span class="ruby-identifier">unshift</span>(<span class="ruby-identifier">io</span>)
1015:     <span class="ruby-keyword kw">else</span>
1016:       <span class="ruby-identifier">args</span>.<span class="ruby-identifier">unshift</span>(<span class="ruby-value str">&quot;&quot;</span>)
1017:     <span class="ruby-keyword kw">end</span>
1018:     <span class="ruby-identifier">faster_csv</span> = <span class="ruby-identifier">new</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">args</span>)  <span class="ruby-comment cmt"># wrap</span>
1019:     <span class="ruby-keyword kw">yield</span> <span class="ruby-identifier">faster_csv</span>         <span class="ruby-comment cmt"># yield for appending</span>
1020:     <span class="ruby-identifier">faster_csv</span>.<span class="ruby-identifier">string</span>        <span class="ruby-comment cmt"># return final String</span>
1021:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000020" class="method-detail">
        <a name="M000020"></a>

        <div class="method-heading">
          <a href="#M000020" class="method-signature">
          <span class="method-name">generate_line</span><span class="method-args">(row, options = Hash.new)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
This method is a shortcut for converting a single row (<a
href="Array.html">Array</a>) into a CSV <a href="String.html">String</a>.
</p>
<p>
The <tt>options</tt> parameter can be anthing FasterCSV::new() understands.
</p>
<p>
The <tt>:row_sep</tt> <tt>option</tt> defaults to
<tt>$INPUT_RECORD_SEPARATOR</tt> (<tt>$/</tt>) when calling this method.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000020-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000020-source">
<pre>
      <span class="ruby-comment cmt"># File lib/faster_csv.rb, line 1032</span>
1032:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">generate_line</span>(<span class="ruby-identifier">row</span>, <span class="ruby-identifier">options</span> = <span class="ruby-constant">Hash</span>.<span class="ruby-identifier">new</span>)
1033:     <span class="ruby-identifier">options</span> = {<span class="ruby-identifier">:row_sep</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">$INPUT_RECORD_SEPARATOR</span>}.<span class="ruby-identifier">merge</span>(<span class="ruby-identifier">options</span>)
1034:     (<span class="ruby-identifier">new</span>(<span class="ruby-value str">&quot;&quot;</span>, <span class="ruby-identifier">options</span>) <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">row</span>).<span class="ruby-identifier">string</span>
1035:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000021" class="method-detail">
        <a name="M000021"></a>

        <div class="method-heading">
          <a href="#M000021" class="method-signature">
          <span class="method-name">instance</span><span class="method-args">(data = $stdout, options = Hash.new) {|instance| ...}</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
This method will return a <a href="FasterCSV.html">FasterCSV</a> <a
href="FasterCSV.html#M000021">instance</a>, just like FasterCSV::new(), but
the <a href="FasterCSV.html#M000021">instance</a> will be cached and
returned for all future calls to this method for the same <tt>data</tt>
object (tested by Object#object_id()) with the same <tt>options</tt>.
</p>
<p>
If a block is given, the <a href="FasterCSV.html#M000021">instance</a> is
passed to the block and the return value becomes the return value of the
block.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000021-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000021-source">
<pre>
      <span class="ruby-comment cmt"># File lib/faster_csv.rb, line 1046</span>
1046:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">instance</span>(<span class="ruby-identifier">data</span> = <span class="ruby-identifier">$stdout</span>, <span class="ruby-identifier">options</span> = <span class="ruby-constant">Hash</span>.<span class="ruby-identifier">new</span>)
1047:     <span class="ruby-comment cmt"># create a _signature_ for this method call, data object and options</span>
1048:     <span class="ruby-identifier">sig</span> = [<span class="ruby-identifier">data</span>.<span class="ruby-identifier">object_id</span>] <span class="ruby-operator">+</span>
1049:           <span class="ruby-identifier">options</span>.<span class="ruby-identifier">values_at</span>(<span class="ruby-operator">*</span><span class="ruby-constant">DEFAULT_OPTIONS</span>.<span class="ruby-identifier">keys</span>.<span class="ruby-identifier">sort_by</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">sym</span><span class="ruby-operator">|</span> <span class="ruby-identifier">sym</span>.<span class="ruby-identifier">to_s</span> })
1050:     
1051:     <span class="ruby-comment cmt"># fetch or create the instance for this signature</span>
1052:     <span class="ruby-ivar">@@instances</span> <span class="ruby-operator">||=</span> <span class="ruby-constant">Hash</span>.<span class="ruby-identifier">new</span>
1053:     <span class="ruby-identifier">instance</span>    =   (<span class="ruby-ivar">@@instances</span>[<span class="ruby-identifier">sig</span>] <span class="ruby-operator">||=</span> <span class="ruby-identifier">new</span>(<span class="ruby-identifier">data</span>, <span class="ruby-identifier">options</span>))
1054: 
1055:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">block_given?</span>
1056:       <span class="ruby-keyword kw">yield</span> <span class="ruby-identifier">instance</span>  <span class="ruby-comment cmt"># run block, if given, returning result</span>
1057:     <span class="ruby-keyword kw">else</span>
1058:       <span class="ruby-identifier">instance</span>        <span class="ruby-comment cmt"># or return the instance</span>
1059:     <span class="ruby-keyword kw">end</span>
1060:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000022" class="method-detail">
        <a name="M000022"></a>

        <div class="method-heading">
          <a href="#M000022" class="method-signature">
          <span class="method-name">load</span><span class="method-args">(io_or_str, options = Hash.new)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
This method is the reading counterpart to FasterCSV::dump(). See that
method for a detailed description of the process.
</p>
<p>
You can customize loading by adding a class method called csv_load() which
will be passed a <a href="Hash.html">Hash</a> of meta information, an <a
href="Array.html">Array</a> of headers, and an <a
href="Array.html">Array</a> of fields for the object the method is expected
to return.
</p>
<p>
Remember that all fields will be Strings after this <a
href="FasterCSV.html#M000022">load</a>. If you need something else, use
<tt>options</tt> to setup converters or provide a custom csv_load()
implementation.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000022-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000022-source">
<pre>
      <span class="ruby-comment cmt"># File lib/faster_csv.rb, line 1074</span>
1074:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">load</span>(<span class="ruby-identifier">io_or_str</span>, <span class="ruby-identifier">options</span> = <span class="ruby-constant">Hash</span>.<span class="ruby-identifier">new</span>)
1075:     <span class="ruby-identifier">csv</span> = <span class="ruby-constant">FasterCSV</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">io_or_str</span>, <span class="ruby-identifier">options</span>)
1076:     
1077:     <span class="ruby-comment cmt"># load meta information</span>
1078:     <span class="ruby-identifier">meta</span> = <span class="ruby-constant">Hash</span>[<span class="ruby-operator">*</span><span class="ruby-identifier">csv</span>.<span class="ruby-identifier">shift</span>]
1079:     <span class="ruby-identifier">cls</span>  = <span class="ruby-identifier">meta</span>[<span class="ruby-value str">&quot;class&quot;</span>].<span class="ruby-identifier">split</span>(<span class="ruby-value str">&quot;::&quot;</span>).<span class="ruby-identifier">inject</span>(<span class="ruby-constant">Object</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">c</span>, <span class="ruby-identifier">const</span><span class="ruby-operator">|</span>
1080:       <span class="ruby-identifier">c</span>.<span class="ruby-identifier">const_get</span>(<span class="ruby-identifier">const</span>)
1081:     <span class="ruby-keyword kw">end</span>
1082:     
1083:     <span class="ruby-comment cmt"># load headers</span>
1084:     <span class="ruby-identifier">headers</span> = <span class="ruby-identifier">csv</span>.<span class="ruby-identifier">shift</span>
1085:     
1086:     <span class="ruby-comment cmt"># unserialize each object stored in the file</span>
1087:     <span class="ruby-identifier">results</span> = <span class="ruby-identifier">csv</span>.<span class="ruby-identifier">inject</span>(<span class="ruby-constant">Array</span>.<span class="ruby-identifier">new</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">all</span>, <span class="ruby-identifier">row</span><span class="ruby-operator">|</span>
1088:       <span class="ruby-keyword kw">begin</span>
1089:         <span class="ruby-identifier">obj</span> = <span class="ruby-identifier">cls</span>.<span class="ruby-identifier">csv_load</span>(<span class="ruby-identifier">meta</span>, <span class="ruby-identifier">headers</span>, <span class="ruby-identifier">row</span>)
1090:       <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">NoMethodError</span>
1091:         <span class="ruby-identifier">obj</span> = <span class="ruby-identifier">cls</span>.<span class="ruby-identifier">allocate</span>
1092:         <span class="ruby-identifier">headers</span>.<span class="ruby-identifier">zip</span>(<span class="ruby-identifier">row</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">name</span>, <span class="ruby-identifier">value</span><span class="ruby-operator">|</span>
1093:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">name</span>[<span class="ruby-value">0</span>] <span class="ruby-operator">==</span> <span class="ruby-value">?@</span>
1094:             <span class="ruby-identifier">obj</span>.<span class="ruby-identifier">instance_variable_set</span>(<span class="ruby-identifier">name</span>, <span class="ruby-identifier">value</span>)
1095:           <span class="ruby-keyword kw">else</span>
1096:             <span class="ruby-identifier">obj</span>.<span class="ruby-identifier">send</span>(<span class="ruby-identifier">name</span>, <span class="ruby-identifier">value</span>)
1097:           <span class="ruby-keyword kw">end</span>
1098:         <span class="ruby-keyword kw">end</span>
1099:       <span class="ruby-keyword kw">end</span>
1100:       <span class="ruby-identifier">all</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">obj</span>
1101:     <span class="ruby-keyword kw">end</span>
1102:     
1103:     <span class="ruby-identifier">csv</span>.<span class="ruby-identifier">close</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">io_or_str</span>.<span class="ruby-identifier">is_a?</span> <span class="ruby-constant">String</span>
1104:     
1105:     <span class="ruby-identifier">results</span>
1106:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000029" class="method-detail">
        <a name="M000029"></a>

        <div class="method-heading">
          <a href="#M000029" class="method-signature">
          <span class="method-name">new</span><span class="method-args">(data, options = Hash.new)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
This constructor will wrap either a <a href="String.html">String</a> or IO
object passed in <tt>data</tt> for reading and/or writing. In addition to
the <a href="FasterCSV.html">FasterCSV</a> <a
href="FasterCSV.html#M000021">instance</a> methods, several IO methods are
delegated. (See FasterCSV::open() for a complete list.) If you pass a <a
href="String.html">String</a> for <tt>data</tt>, you can later retrieve it
(after writing to it, for example) with FasterCSV.string().
</p>
<p>
Note that a wrapped <a href="String.html">String</a> will be positioned at
at the beginning (for reading). If you want it at the end (for writing),
use FasterCSV::generate(). If you want any other positioning, pass a preset
StringIO object instead.
</p>
<p>
You may set any reading and/or writing preferences in the <tt>options</tt>
<a href="Hash.html">Hash</a>. Available options are:
</p>
<table>
<tr><td valign="top"><b><tt>:col_sep</tt></b>:</td><td>The <a href="String.html">String</a> placed between <a
href="FasterCSV.html#M000036">each</a> field.

</td></tr>
<tr><td valign="top"><b><tt>:row_sep</tt></b>:</td><td>The <a href="String.html">String</a> appended to the end of <a
href="FasterCSV.html#M000036">each</a> row. This can be set to the special
<tt>:auto</tt> setting, which requests that <a
href="FasterCSV.html">FasterCSV</a> automatically discover this from the
data. Auto-discovery reads ahead in the data looking for the next
<tt>&quot;\r\n&quot;</tt>, <tt>&quot;\n&quot;</tt>, or
<tt>&quot;\r&quot;</tt> sequence. A sequence will be selected even if it
occurs in a quoted field, assuming that you would have the same line
endings there. If none of those sequences is found, <tt>data</tt> is
<tt>ARGF</tt>, <tt>STDIN</tt>, <tt>STDOUT</tt>, or <tt>STDERR</tt>, or the
stream is only available for output, the default
<tt>$INPUT_RECORD_SEPARATOR</tt> (<tt>$/</tt>) is used. Obviously,
discovery takes a little time. Set manually if speed is important.

</td></tr>
<tr><td valign="top"><b><tt>:converters</tt></b>:</td><td>An <a href="Array.html">Array</a> of names from the Converters <a
href="Hash.html">Hash</a> and/or lambdas that handle custom conversion. A
single converter doesn&#8216;t have to be in an <a
href="Array.html">Array</a>.

</td></tr>
<tr><td valign="top"><b><tt>:unconverted_fields</tt></b>:</td><td>If set to <tt>true</tt>, an unconverted_fields() method will be added to
all returned rows (<a href="Array.html">Array</a> or <a
href="FasterCSV/Row.html">FasterCSV::Row</a>) that will return the fields
as they were before convertion. Note that <tt>:headers</tt> supplied by <a
href="Array.html">Array</a> or <a href="String.html">String</a> were not
fields of the document and thus will have an empty <a
href="Array.html">Array</a> attached.

</td></tr>
<tr><td valign="top"><b><tt>:headers</tt></b>:</td><td>If set to <tt>:first_row</tt> or <tt>true</tt>, the initial row of the CSV
file will be treated as a row of headers. If set to an <a
href="Array.html">Array</a>, the contents will be used as the headers. If
set to a <a href="String.html">String</a>, the <a
href="String.html">String</a> is run through a call of
FasterCSV::parse_line() to produce an <a href="Array.html">Array</a> of
headers. This setting causes <a
href="FasterCSV.html#M000040">FasterCSV.shift</a>() to return rows as <a
href="FasterCSV/Row.html">FasterCSV::Row</a> objects instead of Arrays and
<a href="FasterCSV.html#M000026">FasterCSV.read</a>() to return <a
href="FasterCSV/Table.html">FasterCSV::Table</a> objects instead of an <a
href="Array.html">Array</a> of Arrays.

</td></tr>
<tr><td valign="top"><b><tt>:return_headers</tt></b>:</td><td>When <tt>false</tt>, header rows are silently swallowed. If set to
<tt>true</tt>, header rows are returned in a <a
href="FasterCSV/Row.html">FasterCSV::Row</a> object with identical headers
and fields (save that the fields do not go through the converters).

</td></tr>
<tr><td valign="top"><b><tt>:header_converters</tt></b>:</td><td>Identical in functionality to <tt>:converters</tt> save that the
conversions are only made to header rows.

</td></tr>
<tr><td valign="top"><b><tt>:skip_blanks</tt></b>:</td><td>When set to a <tt>true</tt> value, <a href="FasterCSV.html">FasterCSV</a>
will skip over any rows with no content.

</td></tr>
<tr><td valign="top"><b><tt>:force_quotes</tt></b>:</td><td>When set to a <tt>true</tt> value, <a href="FasterCSV.html">FasterCSV</a>
will quote all CSV fields it creates.

</td></tr>
</table>
<p>
See FasterCSV::DEFAULT_OPTIONS for the default settings.
</p>
<p>
Options cannot be overriden in the <a
href="FasterCSV.html#M000021">instance</a> methods for performance reasons,
so be sure to set what you want here.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000029-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000029-source">
<pre>
      <span class="ruby-comment cmt"># File lib/faster_csv.rb, line 1318</span>
1318:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">initialize</span>(<span class="ruby-identifier">data</span>, <span class="ruby-identifier">options</span> = <span class="ruby-constant">Hash</span>.<span class="ruby-identifier">new</span>)
1319:     <span class="ruby-comment cmt"># build the options for this read/write</span>
1320:     <span class="ruby-identifier">options</span> = <span class="ruby-constant">DEFAULT_OPTIONS</span>.<span class="ruby-identifier">merge</span>(<span class="ruby-identifier">options</span>)
1321:     
1322:     <span class="ruby-comment cmt"># create the IO object we will read from</span>
1323:     <span class="ruby-ivar">@io</span> = <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">data</span>.<span class="ruby-identifier">is_a?</span> <span class="ruby-constant">String</span> <span class="ruby-keyword kw">then</span> <span class="ruby-constant">StringIO</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">data</span>) <span class="ruby-keyword kw">else</span> <span class="ruby-identifier">data</span> <span class="ruby-keyword kw">end</span>
1324:     
1325:     <span class="ruby-identifier">init_separators</span>(<span class="ruby-identifier">options</span>)
1326:     <span class="ruby-identifier">init_parsers</span>(<span class="ruby-identifier">options</span>)
1327:     <span class="ruby-identifier">init_converters</span>(<span class="ruby-identifier">options</span>)
1328:     <span class="ruby-identifier">init_headers</span>(<span class="ruby-identifier">options</span>)
1329:     
1330:     <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">options</span>.<span class="ruby-identifier">empty?</span>
1331:       <span class="ruby-identifier">raise</span> <span class="ruby-constant">ArgumentError</span>, <span class="ruby-node">&quot;Unknown options:  #{options.keys.join(', ')}.&quot;</span>
1332:     <span class="ruby-keyword kw">end</span>
1333:     
1334:     <span class="ruby-comment cmt"># track our own lineno since IO gets confused about line-ends is CSV fields</span>
1335:     <span class="ruby-ivar">@lineno</span> = <span class="ruby-value">0</span>
1336:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000023" class="method-detail">
        <a name="M000023"></a>

        <div class="method-heading">
          <a href="#M000023" class="method-signature">
          <span class="method-name">open( filename, mode="r", options = Hash.new ) { |faster_csv| ... }<br />
open( filename, mode="r", options = Hash.new )<br />
</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
This method opens an IO object, and wraps that with <a
href="FasterCSV.html">FasterCSV</a>. This is intended as the primary
interface for writing a CSV file.
</p>
<p>
You may pass any <tt>args</tt> Ruby&#8216;s <a
href="FasterCSV.html#M000023">open</a>() understands followed by an
optional <a href="Hash.html">Hash</a> containing any <tt>options</tt>
FasterCSV::new() understands.
</p>
<p>
This method works like Ruby&#8216;s <a
href="FasterCSV.html#M000023">open</a>() call, in that it will pass a <a
href="FasterCSV.html">FasterCSV</a> object to a provided block and close it
when the block termminates, or it will return the <a
href="FasterCSV.html">FasterCSV</a> object when no block is provided.
(<b>Note</b>: This is different from the standard CSV library which passes
rows to the block. Use FasterCSV::foreach() for that behavior.)
</p>
<p>
An opened <a href="FasterCSV.html">FasterCSV</a> object will delegate to
many IO methods, for convenience. You may call:
</p>
<ul>
<li>binmode()

</li>
<li>close()

</li>
<li>close_read()

</li>
<li>close_write()

</li>
<li>closed?()

</li>
<li>eof()

</li>
<li>eof?()

</li>
<li>fcntl()

</li>
<li>fileno()

</li>
<li>flush()

</li>
<li>fsync()

</li>
<li>ioctl()

</li>
<li>isatty()

</li>
<li>pid()

</li>
<li>pos()

</li>
<li>reopen()

</li>
<li>seek()

</li>
<li>stat()

</li>
<li>sync()

</li>
<li>sync=()

</li>
<li>tell()

</li>
<li>to_i()

</li>
<li>to_io()

</li>
<li>tty?()

</li>
</ul>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000023-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000023-source">
<pre>
      <span class="ruby-comment cmt"># File lib/faster_csv.rb, line 1153</span>
1153:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">open</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">args</span>)
1154:     <span class="ruby-comment cmt"># find the +options+ Hash</span>
1155:     <span class="ruby-identifier">options</span> = <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">args</span>.<span class="ruby-identifier">last</span>.<span class="ruby-identifier">is_a?</span> <span class="ruby-constant">Hash</span> <span class="ruby-keyword kw">then</span> <span class="ruby-identifier">args</span>.<span class="ruby-identifier">pop</span> <span class="ruby-keyword kw">else</span> <span class="ruby-constant">Hash</span>.<span class="ruby-identifier">new</span> <span class="ruby-keyword kw">end</span>
1156:     <span class="ruby-comment cmt"># wrap a File opened with the remaining +args+</span>
1157:     <span class="ruby-identifier">csv</span>     = <span class="ruby-identifier">new</span>(<span class="ruby-constant">File</span>.<span class="ruby-identifier">open</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">args</span>), <span class="ruby-identifier">options</span>)
1158:     
1159:     <span class="ruby-comment cmt"># handle blocks like Ruby's open(), not like the CSV library</span>
1160:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">block_given?</span>
1161:       <span class="ruby-keyword kw">begin</span>
1162:         <span class="ruby-keyword kw">yield</span> <span class="ruby-identifier">csv</span>
1163:       <span class="ruby-keyword kw">ensure</span>
1164:         <span class="ruby-identifier">csv</span>.<span class="ruby-identifier">close</span>
1165:       <span class="ruby-keyword kw">end</span>
1166:     <span class="ruby-keyword kw">else</span>
1167:       <span class="ruby-identifier">csv</span>
1168:     <span class="ruby-keyword kw">end</span>
1169:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000024" class="method-detail">
        <a name="M000024"></a>

        <div class="method-heading">
          <a href="#M000024" class="method-signature">
          <span class="method-name">parse( str, options = Hash.new ) { |row| ... }<br />
parse( str, options = Hash.new )<br />
</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
This method can be used to easily <a
href="FasterCSV.html#M000024">parse</a> CSV out of a <a
href="String.html">String</a>. You may either provide a <tt>block</tt>
which will be called with <a href="FasterCSV.html#M000036">each</a> row of
the <a href="String.html">String</a> in turn, or just use the returned <a
href="Array.html">Array</a> of Arrays (when no <tt>block</tt> is given).
</p>
<p>
You pass your <tt>str</tt> to <a href="FasterCSV.html#M000026">read</a>
from, and an optional <tt>options</tt> <a href="Hash.html">Hash</a>
containing anything FasterCSV::new() understands.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000024-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000024-source">
<pre>
      <span class="ruby-comment cmt"># File lib/faster_csv.rb, line 1183</span>
1183:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">args</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
1184:     <span class="ruby-identifier">csv</span> = <span class="ruby-identifier">new</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">args</span>)
1185:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">block</span>.<span class="ruby-identifier">nil?</span>  <span class="ruby-comment cmt"># slurp contents, if no block is given</span>
1186:       <span class="ruby-keyword kw">begin</span>
1187:         <span class="ruby-identifier">csv</span>.<span class="ruby-identifier">read</span>
1188:       <span class="ruby-keyword kw">ensure</span>
1189:         <span class="ruby-identifier">csv</span>.<span class="ruby-identifier">close</span>
1190:       <span class="ruby-keyword kw">end</span>
1191:     <span class="ruby-keyword kw">else</span>           <span class="ruby-comment cmt"># or pass each row to a provided block</span>
1192:       <span class="ruby-identifier">csv</span>.<span class="ruby-identifier">each</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
1193:     <span class="ruby-keyword kw">end</span>
1194:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000025" class="method-detail">
        <a name="M000025"></a>

        <div class="method-heading">
          <a href="#M000025" class="method-signature">
          <span class="method-name">parse_line</span><span class="method-args">(line, options = Hash.new)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
This method is a shortcut for converting a single line of a CSV <a
href="String.html">String</a> into a into an <a
href="Array.html">Array</a>. Note that if <tt>line</tt> contains multiple
rows, anything beyond the first row is ignored.
</p>
<p>
The <tt>options</tt> parameter can be anthing FasterCSV::new() understands.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000025-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000025-source">
<pre>
      <span class="ruby-comment cmt"># File lib/faster_csv.rb, line 1203</span>
1203:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">parse_line</span>(<span class="ruby-identifier">line</span>, <span class="ruby-identifier">options</span> = <span class="ruby-constant">Hash</span>.<span class="ruby-identifier">new</span>)
1204:     <span class="ruby-identifier">new</span>(<span class="ruby-identifier">line</span>, <span class="ruby-identifier">options</span>).<span class="ruby-identifier">shift</span>
1205:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000026" class="method-detail">
        <a name="M000026"></a>

        <div class="method-heading">
          <a href="#M000026" class="method-signature">
          <span class="method-name">read</span><span class="method-args">(path, options = Hash.new)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Use to slurp a CSV file into an <a href="Array.html">Array</a> of Arrays.
Pass the <tt>path</tt> to the file and any <tt>options</tt>
FasterCSV::new() understands.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000026-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000026-source">
<pre>
      <span class="ruby-comment cmt"># File lib/faster_csv.rb, line 1211</span>
1211:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">read</span>(<span class="ruby-identifier">path</span>, <span class="ruby-identifier">options</span> = <span class="ruby-constant">Hash</span>.<span class="ruby-identifier">new</span>)
1212:     <span class="ruby-identifier">open</span>(<span class="ruby-identifier">path</span>, <span class="ruby-identifier">options</span>) { <span class="ruby-operator">|</span><span class="ruby-identifier">csv</span><span class="ruby-operator">|</span> <span class="ruby-identifier">csv</span>.<span class="ruby-identifier">read</span> }
1213:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000027" class="method-detail">
        <a name="M000027"></a>

        <div class="method-heading">
          <a href="#M000027" class="method-signature">
          <span class="method-name">readlines</span><span class="method-args">(*args)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Alias for FasterCSV::read().
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000027-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000027-source">
<pre>
      <span class="ruby-comment cmt"># File lib/faster_csv.rb, line 1216</span>
1216:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">readlines</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">args</span>)
1217:     <span class="ruby-identifier">read</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">args</span>)
1218:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000028" class="method-detail">
        <a name="M000028"></a>

        <div class="method-heading">
          <a href="#M000028" class="method-signature">
          <span class="method-name">table</span><span class="method-args">(path, options = Hash.new)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
A shortcut for:
</p>
<pre>
  FasterCSV.read( path, { :headers           =&gt; true,
                          :converters        =&gt; :numeric,
                          :header_converters =&gt; :symbol }.merge(options) )
</pre>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000028-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000028-source">
<pre>
      <span class="ruby-comment cmt"># File lib/faster_csv.rb, line 1227</span>
1227:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">table</span>(<span class="ruby-identifier">path</span>, <span class="ruby-identifier">options</span> = <span class="ruby-constant">Hash</span>.<span class="ruby-identifier">new</span>)
1228:     <span class="ruby-identifier">read</span>( <span class="ruby-identifier">path</span>, { <span class="ruby-identifier">:headers</span>           =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">true</span>,
1229:                   <span class="ruby-identifier">:converters</span>        =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">:numeric</span>,
1230:                   <span class="ruby-identifier">:header_converters</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">:symbol</span> }.<span class="ruby-identifier">merge</span>(<span class="ruby-identifier">options</span>) )
1231:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <h3 class="section-bar">Public Instance methods</h3>

      <div id="method-M000031" class="method-detail">
        <a name="M000031"></a>

        <div class="method-heading">
          <a href="#M000031" class="method-signature">
          <span class="method-name">&lt;&lt;</span><span class="method-args">(row)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
The primary write method for wrapped Strings and IOs, <tt>row</tt> (an <a
href="Array.html">Array</a> or <a
href="FasterCSV/Row.html">FasterCSV::Row</a>) is converted to CSV and
appended to the data source. When a <a
href="FasterCSV/Row.html">FasterCSV::Row</a> is passed, only the
row&#8216;s fields() are appended to the output.
</p>
<p>
The data source must be <a href="FasterCSV.html#M000023">open</a> for
writing.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000031-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000031-source">
<pre>
      <span class="ruby-comment cmt"># File lib/faster_csv.rb, line 1370</span>
1370:   <span class="ruby-keyword kw">def</span> <span class="ruby-operator">&lt;&lt;</span>(<span class="ruby-identifier">row</span>)
1371:     <span class="ruby-comment cmt"># handle FasterCSV::Row objects</span>
1372:     <span class="ruby-identifier">row</span> = <span class="ruby-identifier">row</span>.<span class="ruby-identifier">fields</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">row</span>.<span class="ruby-identifier">is_a?</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">class</span><span class="ruby-operator">::</span><span class="ruby-constant">Row</span>
1373:     
1374:     <span class="ruby-ivar">@io</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">row</span>.<span class="ruby-identifier">map</span>(<span class="ruby-operator">&amp;</span><span class="ruby-ivar">@quote</span>).<span class="ruby-identifier">join</span>(<span class="ruby-ivar">@col_sep</span>) <span class="ruby-operator">+</span> <span class="ruby-ivar">@row_sep</span>  <span class="ruby-comment cmt"># quote and separate</span>
1375:     
1376:     <span class="ruby-keyword kw">self</span>  <span class="ruby-comment cmt"># for chaining</span>
1377:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000032" class="method-detail">
        <a name="M000032"></a>

        <div class="method-heading">
          <span class="method-name">add_row</span><span class="method-args">(row)</span>
        </div>
      
        <div class="method-description">
          <p>
Alias for #&lt;&lt;
</p>
        </div>
      </div>

      <div id="method-M000034" class="method-detail">
        <a name="M000034"></a>

        <div class="method-heading">
          <a href="#M000034" class="method-signature">
          <span class="method-name">convert( name )<br />
convert { |field| ... }<br />
convert { |field, field_info| ... }<br />
</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
You can use this method to install a FasterCSV::Converters built-in, or
provide a block that handles a custom conversion.
</p>
<p>
If you provide a block that takes one argument, it will be passed the field
and is expected to return the converted value or the field itself. If your
block takes two arguments, it will also be passed a FieldInfo Struct,
containing details about the field. Again, the block should return a
converted field or the field itself.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000034-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000034-source">
<pre>
      <span class="ruby-comment cmt"># File lib/faster_csv.rb, line 1396</span>
1396:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">convert</span>(<span class="ruby-identifier">name</span> = <span class="ruby-keyword kw">nil</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">converter</span>)
1397:     <span class="ruby-identifier">add_converter</span>(<span class="ruby-identifier">:converters</span>, <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">class</span><span class="ruby-operator">::</span><span class="ruby-constant">Converters</span>, <span class="ruby-identifier">name</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">converter</span>)
1398:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000036" class="method-detail">
        <a name="M000036"></a>

        <div class="method-heading">
          <a href="#M000036" class="method-signature">
          <span class="method-name">each</span><span class="method-args">() {|row| ...}</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Yields <a href="FasterCSV.html#M000036">each</a> row of the data source in
turn.
</p>
<p>
Support for Enumerable.
</p>
<p>
The data source must be <a href="FasterCSV.html#M000023">open</a> for
reading.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000036-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000036-source">
<pre>
      <span class="ruby-comment cmt"># File lib/faster_csv.rb, line 1427</span>
1427:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">each</span>
1428:     <span class="ruby-keyword kw">while</span> <span class="ruby-identifier">row</span> = <span class="ruby-identifier">shift</span>
1429:       <span class="ruby-keyword kw">yield</span> <span class="ruby-identifier">row</span>
1430:     <span class="ruby-keyword kw">end</span>
1431:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000041" class="method-detail">
        <a name="M000041"></a>

        <div class="method-heading">
          <span class="method-name">gets</span><span class="method-args">()</span>
        </div>
      
        <div class="method-description">
          <p>
Alias for <a href="FasterCSV.html#M000040">shift</a>
</p>
        </div>
      </div>

      <div id="method-M000035" class="method-detail">
        <a name="M000035"></a>

        <div class="method-heading">
          <a href="#M000035" class="method-signature">
          <span class="method-name">header_convert( name )<br />
header_convert { |field| ... }<br />
header_convert { |field, field_info| ... }<br />
</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Identical to <a href="FasterCSV.html#M000034">FasterCSV.convert</a>(), but
for header rows.
</p>
<p>
Note that this method must be called before header rows are <a
href="FasterCSV.html#M000026">read</a> to have any effect.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000035-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000035-source">
<pre>
      <span class="ruby-comment cmt"># File lib/faster_csv.rb, line 1411</span>
1411:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">header_convert</span>(<span class="ruby-identifier">name</span> = <span class="ruby-keyword kw">nil</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">converter</span>)
1412:     <span class="ruby-identifier">add_converter</span>( <span class="ruby-identifier">:header_converters</span>,
1413:                    <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">class</span><span class="ruby-operator">::</span><span class="ruby-constant">HeaderConverters</span>,
1414:                    <span class="ruby-identifier">name</span>,
1415:                    <span class="ruby-operator">&amp;</span><span class="ruby-identifier">converter</span> )
1416:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000039" class="method-detail">
        <a name="M000039"></a>

        <div class="method-heading">
          <a href="#M000039" class="method-signature">
          <span class="method-name">header_row?</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Returns <tt>true</tt> if the next row <a
href="FasterCSV.html#M000026">read</a> will be a header row.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000039-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000039-source">
<pre>
      <span class="ruby-comment cmt"># File lib/faster_csv.rb, line 1449</span>
1449:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">header_row?</span>
1450:     <span class="ruby-ivar">@use_headers</span> <span class="ruby-keyword kw">and</span> <span class="ruby-ivar">@headers</span>.<span class="ruby-identifier">nil?</span>
1451:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000033" class="method-detail">
        <a name="M000033"></a>

        <div class="method-heading">
          <span class="method-name">puts</span><span class="method-args">(row)</span>
        </div>
      
        <div class="method-description">
          <p>
Alias for #&lt;&lt;
</p>
        </div>
      </div>

      <div id="method-M000037" class="method-detail">
        <a name="M000037"></a>

        <div class="method-heading">
          <a href="#M000037" class="method-signature">
          <span class="method-name">read</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Slurps the remaining rows and returns an <a href="Array.html">Array</a> of
Arrays.
</p>
<p>
The data source must be <a href="FasterCSV.html#M000023">open</a> for
reading.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000037-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000037-source">
<pre>
      <span class="ruby-comment cmt"># File lib/faster_csv.rb, line 1438</span>
1438:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">read</span>
1439:     <span class="ruby-identifier">rows</span> = <span class="ruby-identifier">to_a</span>
1440:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@use_headers</span>
1441:       <span class="ruby-constant">Table</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">rows</span>)
1442:     <span class="ruby-keyword kw">else</span>
1443:       <span class="ruby-identifier">rows</span>
1444:     <span class="ruby-keyword kw">end</span>
1445:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000042" class="method-detail">
        <a name="M000042"></a>

        <div class="method-heading">
          <span class="method-name">readline</span><span class="method-args">()</span>
        </div>
      
        <div class="method-description">
          <p>
Alias for <a href="FasterCSV.html#M000040">shift</a>
</p>
        </div>
      </div>

      <div id="method-M000038" class="method-detail">
        <a name="M000038"></a>

        <div class="method-heading">
          <span class="method-name">readlines</span><span class="method-args">()</span>
        </div>
      
        <div class="method-description">
          <p>
Alias for <a href="FasterCSV.html#M000026">read</a>
</p>
        </div>
      </div>

      <div id="method-M000030" class="method-detail">
        <a name="M000030"></a>

        <div class="method-heading">
          <a href="#M000030" class="method-signature">
          <span class="method-name">rewind</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Rewinds the underlying IO object and resets <a
href="FasterCSV.html">FasterCSV</a>&#8216;s lineno() counter.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000030-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000030-source">
<pre>
      <span class="ruby-comment cmt"># File lib/faster_csv.rb, line 1353</span>
1353:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">rewind</span>
1354:     <span class="ruby-ivar">@headers</span> = <span class="ruby-keyword kw">nil</span>
1355:     <span class="ruby-ivar">@lineno</span>  = <span class="ruby-value">0</span>
1356:     
1357:     <span class="ruby-ivar">@io</span>.<span class="ruby-identifier">rewind</span>
1358:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000040" class="method-detail">
        <a name="M000040"></a>

        <div class="method-heading">
          <a href="#M000040" class="method-signature">
          <span class="method-name">shift</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
The primary <a href="FasterCSV.html#M000026">read</a> method for wrapped
Strings and IOs, a single row is pulled from the data source, parsed and
returned as an <a href="Array.html">Array</a> of fields (if header rows are
not used) or a <a href="FasterCSV/Row.html">FasterCSV::Row</a> (when header
rows are used).
</p>
<p>
The data source must be <a href="FasterCSV.html#M000023">open</a> for
reading.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000040-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000040-source">
<pre>
      <span class="ruby-comment cmt"># File lib/faster_csv.rb, line 1460</span>
1460:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">shift</span>
1461:     <span class="ruby-comment cmt">#########################################################################</span>
1462:     <span class="ruby-comment cmt">### This method is purposefully kept a bit long as simple conditional ###</span>
1463:     <span class="ruby-comment cmt">### checks are faster than numerous (expensive) method calls.         ###</span>
1464:     <span class="ruby-comment cmt">#########################################################################</span>
1465:     
1466:     <span class="ruby-comment cmt"># handle headers not based on document content</span>
1467:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">header_row?</span> <span class="ruby-keyword kw">and</span> <span class="ruby-ivar">@return_headers</span> <span class="ruby-keyword kw">and</span>
1468:        [<span class="ruby-constant">Array</span>, <span class="ruby-constant">String</span>].<span class="ruby-identifier">include?</span> <span class="ruby-ivar">@use_headers</span>.<span class="ruby-identifier">class</span>
1469:       <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@unconverted_fields</span>
1470:         <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">add_unconverted_fields</span>(<span class="ruby-identifier">parse_headers</span>, <span class="ruby-constant">Array</span>.<span class="ruby-identifier">new</span>)
1471:       <span class="ruby-keyword kw">else</span>
1472:         <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">parse_headers</span>
1473:       <span class="ruby-keyword kw">end</span>
1474:     <span class="ruby-keyword kw">end</span>
1475:     
1476:     <span class="ruby-comment cmt"># begin with a blank line, so we can always add to it</span>
1477:     <span class="ruby-identifier">line</span> = <span class="ruby-value str">&quot;&quot;</span>
1478: 
1479:     <span class="ruby-comment cmt"># </span>
1480:     <span class="ruby-comment cmt"># it can take multiple calls to &lt;tt&gt;@io.gets()&lt;/tt&gt; to get a full line,</span>
1481:     <span class="ruby-comment cmt"># because of \r and/or \n characters embedded in quoted fields</span>
1482:     <span class="ruby-comment cmt"># </span>
1483:     <span class="ruby-identifier">loop</span> <span class="ruby-keyword kw">do</span>
1484:       <span class="ruby-comment cmt"># add another read to the line</span>
1485:       <span class="ruby-identifier">line</span>  <span class="ruby-operator">+=</span> <span class="ruby-ivar">@io</span>.<span class="ruby-identifier">gets</span>(<span class="ruby-ivar">@row_sep</span>) <span class="ruby-keyword kw">rescue</span> <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">nil</span>
1486:       <span class="ruby-comment cmt"># copy the line so we can chop it up in parsing</span>
1487:       <span class="ruby-identifier">parse</span> = <span class="ruby-identifier">line</span>.<span class="ruby-identifier">dup</span>
1488:       <span class="ruby-identifier">parse</span>.<span class="ruby-identifier">sub!</span>(<span class="ruby-ivar">@parsers</span>[<span class="ruby-identifier">:line_end</span>], <span class="ruby-value str">&quot;&quot;</span>)
1489:       
1490:       <span class="ruby-comment cmt"># </span>
1491:       <span class="ruby-comment cmt"># I believe a blank line should be an &lt;tt&gt;Array.new&lt;/tt&gt;, not </span>
1492:       <span class="ruby-comment cmt"># CSV's &lt;tt&gt;[nil]&lt;/tt&gt;</span>
1493:       <span class="ruby-comment cmt"># </span>
1494:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">parse</span>.<span class="ruby-identifier">empty?</span>
1495:         <span class="ruby-ivar">@lineno</span> <span class="ruby-operator">+=</span> <span class="ruby-value">1</span>
1496:         <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@skip_blanks</span>
1497:           <span class="ruby-identifier">line</span> = <span class="ruby-value str">&quot;&quot;</span>
1498:           <span class="ruby-keyword kw">next</span>
1499:         <span class="ruby-keyword kw">elsif</span> <span class="ruby-ivar">@unconverted_fields</span>
1500:           <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">add_unconverted_fields</span>(<span class="ruby-constant">Array</span>.<span class="ruby-identifier">new</span>, <span class="ruby-constant">Array</span>.<span class="ruby-identifier">new</span>)
1501:         <span class="ruby-keyword kw">elsif</span> <span class="ruby-ivar">@use_headers</span>
1502:           <span class="ruby-keyword kw">return</span> <span class="ruby-constant">FasterCSV</span><span class="ruby-operator">::</span><span class="ruby-constant">Row</span>.<span class="ruby-identifier">new</span>(<span class="ruby-constant">Array</span>.<span class="ruby-identifier">new</span>, <span class="ruby-constant">Array</span>.<span class="ruby-identifier">new</span>)
1503:         <span class="ruby-keyword kw">else</span>
1504:           <span class="ruby-keyword kw">return</span> <span class="ruby-constant">Array</span>.<span class="ruby-identifier">new</span>
1505:         <span class="ruby-keyword kw">end</span>
1506:       <span class="ruby-keyword kw">end</span>
1507: 
1508:       <span class="ruby-comment cmt"># </span>
1509:       <span class="ruby-comment cmt"># shave leading empty fields if needed, because the main parser chokes </span>
1510:       <span class="ruby-comment cmt"># on these</span>
1511:       <span class="ruby-comment cmt"># </span>
1512:       <span class="ruby-identifier">csv</span> = <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">parse</span>.<span class="ruby-identifier">sub!</span>(<span class="ruby-ivar">@parsers</span>[<span class="ruby-identifier">:leading_fields</span>], <span class="ruby-value str">&quot;&quot;</span>)
1513:         [<span class="ruby-keyword kw">nil</span>] <span class="ruby-operator">*</span> (<span class="ruby-identifier">$&amp;</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">/</span> <span class="ruby-ivar">@col_sep</span>.<span class="ruby-identifier">length</span>)
1514:       <span class="ruby-keyword kw">else</span>
1515:         <span class="ruby-constant">Array</span>.<span class="ruby-identifier">new</span>
1516:       <span class="ruby-keyword kw">end</span>
1517:       <span class="ruby-comment cmt"># </span>
1518:       <span class="ruby-comment cmt"># then parse the main fields with a hyper-tuned Regexp from </span>
1519:       <span class="ruby-comment cmt"># Mastering Regular Expressions, Second Edition</span>
1520:       <span class="ruby-comment cmt"># </span>
1521:       <span class="ruby-identifier">parse</span>.<span class="ruby-identifier">gsub!</span>(<span class="ruby-ivar">@parsers</span>[<span class="ruby-identifier">:csv_row</span>]) <span class="ruby-keyword kw">do</span>
1522:         <span class="ruby-identifier">csv</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">$1</span>.<span class="ruby-identifier">nil?</span>     <span class="ruby-comment cmt"># we found an unquoted field</span>
1523:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">$2</span>.<span class="ruby-identifier">empty?</span>        <span class="ruby-comment cmt"># switch empty unquoted fields to +nil+...</span>
1524:             <span class="ruby-keyword kw">nil</span>               <span class="ruby-comment cmt"># for CSV compatibility</span>
1525:           <span class="ruby-keyword kw">else</span>
1526:             <span class="ruby-comment cmt"># I decided to take a strict approach to CSV parsing...</span>
1527:             <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">$2</span>.<span class="ruby-identifier">count</span>(<span class="ruby-value str">&quot;\r\n&quot;</span>).<span class="ruby-identifier">zero?</span>  <span class="ruby-comment cmt"># verify correctness of field...</span>
1528:               <span class="ruby-identifier">$2</span>
1529:             <span class="ruby-keyword kw">else</span>
1530:               <span class="ruby-comment cmt"># or throw an Exception</span>
1531:               <span class="ruby-identifier">raise</span> <span class="ruby-constant">MalformedCSVError</span>, <span class="ruby-value str">&quot;Unquoted fields do not allow &quot;</span> <span class="ruby-operator">+</span>
1532:                                        <span class="ruby-node">&quot;\\r or \\n (line #{lineno + 1}).&quot;</span>
1533:             <span class="ruby-keyword kw">end</span>
1534:           <span class="ruby-keyword kw">end</span>
1535:         <span class="ruby-keyword kw">else</span>                  <span class="ruby-comment cmt"># we found a quoted field...</span>
1536:           <span class="ruby-identifier">$1</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-value str">'&quot;&quot;'</span>, <span class="ruby-value str">'&quot;'</span>)  <span class="ruby-comment cmt"># unescape contents</span>
1537:         <span class="ruby-keyword kw">end</span>
1538:         <span class="ruby-value str">&quot;&quot;</span>  <span class="ruby-comment cmt"># gsub!'s replacement, clear the field</span>
1539:       <span class="ruby-keyword kw">end</span>
1540: 
1541:       <span class="ruby-comment cmt"># if parse is empty?(), we found all the fields on the line...</span>
1542:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">parse</span>.<span class="ruby-identifier">empty?</span>
1543:         <span class="ruby-ivar">@lineno</span> <span class="ruby-operator">+=</span> <span class="ruby-value">1</span>
1544: 
1545:         <span class="ruby-comment cmt"># save fields unconverted fields, if needed...</span>
1546:         <span class="ruby-identifier">unconverted</span> = <span class="ruby-identifier">csv</span>.<span class="ruby-identifier">dup</span> <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@unconverted_fields</span>
1547: 
1548:         <span class="ruby-comment cmt"># convert fields, if needed...</span>
1549:         <span class="ruby-identifier">csv</span> = <span class="ruby-identifier">convert_fields</span>(<span class="ruby-identifier">csv</span>) <span class="ruby-keyword kw">unless</span> <span class="ruby-ivar">@use_headers</span> <span class="ruby-keyword kw">or</span> <span class="ruby-ivar">@converters</span>.<span class="ruby-identifier">empty?</span>
1550:         <span class="ruby-comment cmt"># parse out header rows and handle FasterCSV::Row conversions...</span>
1551:         <span class="ruby-identifier">csv</span> = <span class="ruby-identifier">parse_headers</span>(<span class="ruby-identifier">csv</span>)  <span class="ruby-keyword kw">if</span>     <span class="ruby-ivar">@use_headers</span>
1552: 
1553:         <span class="ruby-comment cmt"># inject unconverted fields and accessor, if requested...</span>
1554:         <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@unconverted_fields</span> <span class="ruby-keyword kw">and</span> <span class="ruby-keyword kw">not</span> <span class="ruby-identifier">csv</span>.<span class="ruby-identifier">respond_to?</span> <span class="ruby-identifier">:unconverted_fields</span>
1555:           <span class="ruby-identifier">add_unconverted_fields</span>(<span class="ruby-identifier">csv</span>, <span class="ruby-identifier">unconverted</span>)
1556:         <span class="ruby-keyword kw">end</span>
1557: 
1558:         <span class="ruby-comment cmt"># return the results</span>
1559:         <span class="ruby-keyword kw">break</span> <span class="ruby-identifier">csv</span>
1560:       <span class="ruby-keyword kw">end</span>
1561:       <span class="ruby-comment cmt"># if we're not empty?() but at eof?(), a quoted field wasn't closed...</span>
1562:       <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@io</span>.<span class="ruby-identifier">eof?</span>
1563:         <span class="ruby-identifier">raise</span> <span class="ruby-constant">MalformedCSVError</span>, <span class="ruby-node">&quot;Unclosed quoted field on line #{lineno + 1}.&quot;</span>
1564:       <span class="ruby-keyword kw">end</span>
1565:       <span class="ruby-comment cmt"># otherwise, we need to loop and pull some more data to complete the row</span>
1566:     <span class="ruby-keyword kw">end</span>
1567:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>


    </div>


  </div>


<div id="validator-badges">
  <p><small><a href="http://validator.w3.org/check/referer">[Validate]</a></small></p>
</div>

</body>
</html>